<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Mir: prompt_session.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Mir
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">prompt_session.c</div>  </div>
</div><!--header-->
<div class="contents">
<p>A mir client demonstrating prompt sessions. </p>
<h1><a class="anchor" id="PsMirDemoState"></a>
MirDemoState</h1>
<p>The handles needs to be accessible both to callbacks and to the control function. </p><div class="fragment"><div class="line"><span class="comment">// Utility structure for the state of a single session.</span></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span><a name="a0"></a><a class="code" href="prompt__session_8c.html#ab12d2092e33dd10fed15d4ed23f5c572">MirDemoState</a></div><div class="line">{</div><div class="line">    <a class="code" href="group__mir__toolkit.html#gad3936156a02cd24658178bca6be4bd9e">MirConnection</a> *connection;</div><div class="line">    <a class="code" href="group__mir__toolkit.html#ga4f71f6d4ba268c6a48a2fbcc7b9938e5">MirWindow</a> *window;</div><div class="line">    <a class="code" href="group__mir__toolkit.html#ga9f1913a41e6200b771c947cf072b2670">MirPromptSession</a> *prompt_session;</div><div class="line">    pid_t  child_pid;</div><div class="line">    <a class="code" href="group__mir__toolkit.html#gadf141a24bee0d5dcfd3d4d42c5793896">MirPromptSessionState</a> state;</div><div class="line"></div><div class="line">    <span class="keywordtype">int</span>* client_fds;</div><div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> client_fd_count;</div><div class="line">    pthread_mutex_t mutex;</div><div class="line">    pthread_cond_t cond;</div><div class="line">} <a class="code" href="prompt__session_8c.html#ab12d2092e33dd10fed15d4ed23f5c572">MirDemoState</a>;</div></div><!-- fragment --><h1><a class="anchor" id="PsCallbacks"></a>
Callbacks</h1>
<div class="fragment"><div class="line"><span class="comment">// Callback to update MirDemoState on prompt_session_event</span></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> prompt_session_event_callback(<a class="code" href="group__mir__toolkit.html#ga9f1913a41e6200b771c947cf072b2670">MirPromptSession</a>* prompt_session,</div><div class="line">                                         <a class="code" href="group__mir__toolkit.html#gadf141a24bee0d5dcfd3d4d42c5793896">MirPromptSessionState</a> state,</div><div class="line">                                         <span class="keywordtype">void</span>* context)</div><div class="line">{</div><div class="line">    (void)prompt_session;</div><div class="line">    <a class="code" href="prompt__session_8c.html#ab12d2092e33dd10fed15d4ed23f5c572">MirDemoState</a>* demo_state = (<a class="code" href="prompt__session_8c.html#ab12d2092e33dd10fed15d4ed23f5c572">MirDemoState</a>*)context;</div><div class="line">    demo_state-&gt;state = state;</div><div class="line"></div><div class="line">    printf(<span class="stringliteral">&quot;helper: Prompt Session state updated to %d\n&quot;</span>, state);</div><div class="line">    <span class="keywordflow">if</span> (state == <a name="a1"></a><a class="code" href="group__mir__toolkit.html#ggadf141a24bee0d5dcfd3d4d42c5793896ac25834997e3602675f2eafdc0b825934">mir_prompt_session_state_stopped</a>)</div><div class="line">    {</div><div class="line">        <a name="a2"></a><a class="code" href="namespacemiral.html#a8ea718a9ca45e67a09630e022af689ea">kill</a>(demo_state-&gt;child_pid, SIGINT);</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> client_fd_callback(<a class="code" href="group__mir__toolkit.html#ga9f1913a41e6200b771c947cf072b2670">MirPromptSession</a>* prompt_session, <span class="keywordtype">size_t</span> count, <span class="keywordtype">int</span> <span class="keyword">const</span>* fds, <span class="keywordtype">void</span>* context)</div><div class="line">{</div><div class="line">    (void)prompt_session;</div><div class="line">    <a class="code" href="prompt__session_8c.html#ab12d2092e33dd10fed15d4ed23f5c572">MirDemoState</a>* mcd = (<a class="code" href="prompt__session_8c.html#ab12d2092e33dd10fed15d4ed23f5c572">MirDemoState</a>*)context;</div><div class="line">    pthread_mutex_lock(&amp;mcd-&gt;mutex);</div><div class="line">    mcd-&gt;client_fds = malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>)*count);</div><div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0;</div><div class="line">    <span class="keywordflow">for</span> (; i &lt; count; i++)</div><div class="line">    {</div><div class="line">        mcd-&gt;client_fds[i] = fds[i];</div><div class="line">    }</div><div class="line"></div><div class="line">    mcd-&gt;client_fd_count = count;</div><div class="line">    pthread_cond_signal(&amp;mcd-&gt;cond);</div><div class="line">    pthread_mutex_unlock(&amp;mcd-&gt;mutex);</div><div class="line">}</div></div><!-- fragment --><p> This program creates two processes, both opening a mir connection, one starting a prompt session with the other process.</p>
<div class="fragment"><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"> * Copyright Â© 2014 Canonical Ltd.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * This program is free software: you can redistribute it and/or modify</span></div><div class="line"><span class="comment"> * it under the terms of the GNU General Public License version 2 or 3 as</span></div><div class="line"><span class="comment"> * published by the Free Software Foundation.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * This program is distributed in the hope that it will be useful,</span></div><div class="line"><span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div><div class="line"><span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></div><div class="line"><span class="comment"> * GNU General Public License for more details.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * You should have received a copy of the GNU General Public License</span></div><div class="line"><span class="comment"> * along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * Authored by: Nick Dedekind &lt;nick.dedekind &lt;nick.dedekind@canonical.com&gt;</span></div><div class="line"><span class="comment"> */</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define _POSIX_SOURCE</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="mir__client__library_8h.html">mir_toolkit/mir_client_library.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="mir__prompt__session_8h.html">mir_toolkit/mir_prompt_session.h</a>&quot;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#undef NDEBUG</span></div><div class="line"><span class="preprocessor">#include &lt;assert.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;getopt.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;pthread.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;unistd.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;errno.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;sys/wait.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;sys/types.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;signal.h&gt;</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// Utility structure for the state of a single session.</span></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="prompt__session_8c.html#ab12d2092e33dd10fed15d4ed23f5c572">MirDemoState</a></div><div class="line">{</div><div class="line">    <a class="code" href="group__mir__toolkit.html#gad3936156a02cd24658178bca6be4bd9e">MirConnection</a> *connection;</div><div class="line">    <a class="code" href="group__mir__toolkit.html#ga4f71f6d4ba268c6a48a2fbcc7b9938e5">MirWindow</a> *window;</div><div class="line">    <a class="code" href="group__mir__toolkit.html#ga9f1913a41e6200b771c947cf072b2670">MirPromptSession</a> *prompt_session;</div><div class="line">    pid_t  child_pid;</div><div class="line">    <a class="code" href="group__mir__toolkit.html#gadf141a24bee0d5dcfd3d4d42c5793896">MirPromptSessionState</a> state;</div><div class="line"></div><div class="line">    <span class="keywordtype">int</span>* client_fds;</div><div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> client_fd_count;</div><div class="line">    pthread_mutex_t mutex;</div><div class="line">    pthread_cond_t cond;</div><div class="line">} <a class="code" href="prompt__session_8c.html#ab12d2092e33dd10fed15d4ed23f5c572">MirDemoState</a>;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// Callback to update MirDemoState on prompt_session_event</span></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> prompt_session_event_callback(<a class="code" href="group__mir__toolkit.html#ga9f1913a41e6200b771c947cf072b2670">MirPromptSession</a>* prompt_session,</div><div class="line">                                         <a class="code" href="group__mir__toolkit.html#gadf141a24bee0d5dcfd3d4d42c5793896">MirPromptSessionState</a> state,</div><div class="line">                                         <span class="keywordtype">void</span>* context)</div><div class="line">{</div><div class="line">    (void)prompt_session;</div><div class="line">    <a class="code" href="prompt__session_8c.html#ab12d2092e33dd10fed15d4ed23f5c572">MirDemoState</a>* demo_state = (<a class="code" href="prompt__session_8c.html#ab12d2092e33dd10fed15d4ed23f5c572">MirDemoState</a>*)context;</div><div class="line">    demo_state-&gt;state = state;</div><div class="line"></div><div class="line">    printf(<span class="stringliteral">&quot;helper: Prompt Session state updated to %d\n&quot;</span>, state);</div><div class="line">    <span class="keywordflow">if</span> (state == <a class="code" href="group__mir__toolkit.html#ggadf141a24bee0d5dcfd3d4d42c5793896ac25834997e3602675f2eafdc0b825934">mir_prompt_session_state_stopped</a>)</div><div class="line">    {</div><div class="line">        <a class="code" href="namespacemiral.html#a8ea718a9ca45e67a09630e022af689ea">kill</a>(demo_state-&gt;child_pid, SIGINT);</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> client_fd_callback(<a class="code" href="group__mir__toolkit.html#ga9f1913a41e6200b771c947cf072b2670">MirPromptSession</a>* prompt_session, <span class="keywordtype">size_t</span> count, <span class="keywordtype">int</span> <span class="keyword">const</span>* fds, <span class="keywordtype">void</span>* context)</div><div class="line">{</div><div class="line">    (void)prompt_session;</div><div class="line">    <a class="code" href="prompt__session_8c.html#ab12d2092e33dd10fed15d4ed23f5c572">MirDemoState</a>* mcd = (<a class="code" href="prompt__session_8c.html#ab12d2092e33dd10fed15d4ed23f5c572">MirDemoState</a>*)context;</div><div class="line">    pthread_mutex_lock(&amp;mcd-&gt;mutex);</div><div class="line">    mcd-&gt;client_fds = malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>)*count);</div><div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0;</div><div class="line">    <span class="keywordflow">for</span> (; i &lt; count; i++)</div><div class="line">    {</div><div class="line">        mcd-&gt;client_fds[i] = fds[i];</div><div class="line">    }</div><div class="line"></div><div class="line">    mcd-&gt;client_fd_count = count;</div><div class="line">    pthread_cond_signal(&amp;mcd-&gt;cond);</div><div class="line">    pthread_mutex_unlock(&amp;mcd-&gt;mutex);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> <a name="a3"></a><a class="code" href="prompt__session_8c.html#a49ad803f6640e89ea751d752790c2122">start_session</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* server, <span class="keyword">const</span> <span class="keywordtype">char</span>* <a name="a4"></a><a class="code" href="client__types_8h.html#a5f1de76dd5d451949e12c0fbc966ca70">name</a>, <a class="code" href="prompt__session_8c.html#ab12d2092e33dd10fed15d4ed23f5c572">MirDemoState</a>* mcd)</div><div class="line">{</div><div class="line">    <span class="comment">// Call mir_connect synchronously</span></div><div class="line">    mcd-&gt;connection = <a name="a5"></a><a class="code" href="group__mir__toolkit.html#gaf8c65b7597fc560616747cf259dcc045">mir_connect_sync</a>(server, <a class="code" href="client__types_8h.html#a5f1de76dd5d451949e12c0fbc966ca70">name</a>);</div><div class="line"></div><div class="line">    <span class="comment">// We expect a connection handle;</span></div><div class="line">    <span class="comment">// we expect it to be valid; and,</span></div><div class="line">    <span class="comment">// we don&#39;t expect an error description</span></div><div class="line">    assert(mcd-&gt;connection != NULL);</div><div class="line">    assert(<a name="a6"></a><a class="code" href="group__mir__toolkit.html#ga5dad61d745ee5707f7a143c6732c9e46">mir_connection_is_valid</a>(mcd-&gt;connection));</div><div class="line">    assert(strcmp(<a name="a7"></a><a class="code" href="group__mir__toolkit.html#ga0c4ee044830aacb0770e0823031e3ea1">mir_connection_get_error_message</a>(mcd-&gt;connection), <span class="stringliteral">&quot;&quot;</span>) == 0);</div><div class="line">    printf(<span class="stringliteral">&quot;%s: Connected\n&quot;</span>, <a class="code" href="client__types_8h.html#a5f1de76dd5d451949e12c0fbc966ca70">name</a>);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> <a name="a8"></a><a class="code" href="prompt__session_8c.html#a9e1d5207a160988089525cf90866e499">stop_session</a>(<a class="code" href="prompt__session_8c.html#ab12d2092e33dd10fed15d4ed23f5c572">MirDemoState</a>* mcd, <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="client__types_8h.html#a5f1de76dd5d451949e12c0fbc966ca70">name</a>)</div><div class="line">{</div><div class="line">    <span class="keywordflow">if</span> (mcd-&gt;window)</div><div class="line">    {</div><div class="line">        <span class="comment">// We should release our window</span></div><div class="line">        <a name="a9"></a><a class="code" href="group__mir__toolkit.html#gaa7b7e2e8e8eda38ff03bc9ea34833d76">mir_window_release_sync</a>(mcd-&gt;window);</div><div class="line">        mcd-&gt;window = 0;</div><div class="line">        printf(<span class="stringliteral">&quot;%s: Window released\n&quot;</span>, name);</div><div class="line">    }</div><div class="line"></div><div class="line">    pthread_cond_destroy(&amp;mcd-&gt;cond);</div><div class="line">    pthread_mutex_destroy(&amp;mcd-&gt;mutex);</div><div class="line"></div><div class="line">    <span class="comment">// We should release our connection</span></div><div class="line">    <a name="a10"></a><a class="code" href="group__mir__toolkit.html#ga50872f3adae37463ae2543cb5adab7e9">mir_connection_release</a>(mcd-&gt;connection);</div><div class="line">    printf(<span class="stringliteral">&quot;%s: Connection released\n&quot;</span>, name);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> <a name="a11"></a><a class="code" href="prompt__session_8c.html#a256fca07a603d0fa779f6e01be962923">helper</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* server)</div><div class="line">{</div><div class="line">    <a class="code" href="prompt__session_8c.html#ab12d2092e33dd10fed15d4ed23f5c572">MirDemoState</a> mcd;</div><div class="line">    mcd.connection = 0;</div><div class="line">    mcd.window = 0;</div><div class="line">    mcd.prompt_session = 0;</div><div class="line">    mcd.state = <a class="code" href="group__mir__toolkit.html#ggadf141a24bee0d5dcfd3d4d42c5793896ac25834997e3602675f2eafdc0b825934">mir_prompt_session_state_stopped</a>;</div><div class="line">    mcd.client_fd_count = 0;</div><div class="line">    <a class="code" href="prompt__session_8c.html#a49ad803f6640e89ea751d752790c2122">start_session</a>(server, <span class="stringliteral">&quot;helper&quot;</span>, &amp;mcd);</div><div class="line"></div><div class="line">    <span class="keywordtype">int</span> <a name="a12"></a><a class="code" href="namespacemir_1_1dispatch.html#a1193057c5af0cf923bb4090e7baad1cfa8fafb02ca3c9ad270f620b56400b8b5b">error</a> = pthread_mutex_init(&amp;mcd.mutex, NULL);</div><div class="line">    <span class="keywordflow">if</span> (error)</div><div class="line">    {</div><div class="line">        fprintf(stderr, <span class="stringliteral">&quot;Failed to init mutex: %s&quot;</span>, strerror(error));</div><div class="line">    }</div><div class="line"></div><div class="line">    error = pthread_cond_init(&amp;mcd.cond, NULL);</div><div class="line">    <span class="keywordflow">if</span> (error)</div><div class="line">    {</div><div class="line">        fprintf(stderr, <span class="stringliteral">&quot;Failed to init cond: %s&quot;</span>, strerror(error));</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// We create a prompt session</span></div><div class="line">    mcd.prompt_session = <a name="a13"></a><a class="code" href="group__mir__toolkit.html#ga585915de8554b82addce2bfea22bce77">mir_connection_create_prompt_session_sync</a>(mcd.connection, getpid(), prompt_session_event_callback, &amp;mcd);</div><div class="line">    assert(mcd.prompt_session != NULL);</div><div class="line"></div><div class="line">    assert(mcd.state == <a name="a14"></a><a class="code" href="group__mir__toolkit.html#ggadf141a24bee0d5dcfd3d4d42c5793896ade15c4d02ec1d86644496137de940912">mir_prompt_session_state_started</a>);</div><div class="line">    puts(<span class="stringliteral">&quot;helper: Started prompt session&quot;</span>);</div><div class="line"></div><div class="line">    <a name="a15"></a><a class="code" href="group__mir__toolkit.html#gaf5397636083075a983d39e999dcd5846">mir_prompt_session_new_fds_for_prompt_providers</a>(mcd.prompt_session, 1, client_fd_callback, &amp;mcd);</div><div class="line"></div><div class="line">    pthread_mutex_lock(&amp;mcd.mutex);</div><div class="line">    <span class="keywordflow">while</span> (mcd.client_fd_count == 0)</div><div class="line">    {</div><div class="line">        pthread_cond_wait(&amp;mcd.cond, &amp;mcd.mutex);</div><div class="line">    }</div><div class="line">    pthread_mutex_unlock(&amp;mcd.mutex);</div><div class="line"></div><div class="line">    assert(mcd.client_fd_count == 1);</div><div class="line">    puts(<span class="stringliteral">&quot;helper: Added waiting FD&quot;</span>);</div><div class="line"></div><div class="line">    printf(<span class="stringliteral">&quot;helper: Starting child application &#39;mir_demo_client_basic&#39; with fd://%d\n&quot;</span>, mcd.client_fds[0]);</div><div class="line">    mcd.child_pid = fork();</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (mcd.child_pid == 0)</div><div class="line">    {</div><div class="line">        <span class="keywordtype">char</span> buffer[128] = {0};</div><div class="line">        sprintf(buffer, <span class="stringliteral">&quot;fd://%d&quot;</span>, mcd.client_fds[0]);</div><div class="line"></div><div class="line">        <span class="keywordtype">char</span>* args[4];</div><div class="line">        args[0] = <span class="stringliteral">&quot;mir_demo_client_basic&quot;</span>;</div><div class="line">        args[1] = <span class="stringliteral">&quot;-m&quot;</span>;</div><div class="line">        args[2] = &amp;buffer[0];</div><div class="line">        args[3] = NULL;</div><div class="line"></div><div class="line">        errno = 0;</div><div class="line">        execvp(<span class="stringliteral">&quot;mir_demo_client_basic&quot;</span>, args);</div><div class="line">        <span class="keywordflow">return</span>;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordtype">int</span> status;</div><div class="line">    printf(<span class="stringliteral">&quot;helper: Waiting on child application: %d\n&quot;</span>, mcd.child_pid);</div><div class="line">    waitpid(mcd.child_pid, &amp;status, 0);</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (mcd.state == <a class="code" href="group__mir__toolkit.html#ggadf141a24bee0d5dcfd3d4d42c5793896ade15c4d02ec1d86644496137de940912">mir_prompt_session_state_started</a>)</div><div class="line">    {</div><div class="line">        <a name="a16"></a><a class="code" href="group__mir__toolkit.html#ga7a0017d2eefc81144d59e6286bf9612d">mir_prompt_session_release_sync</a>(mcd.prompt_session);</div><div class="line">        mcd.prompt_session = NULL;</div><div class="line">        puts(<span class="stringliteral">&quot;helper: Stopped prompt session&quot;</span>);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">    {</div><div class="line">        puts(<span class="stringliteral">&quot;helper: Prompt session stopped by server&quot;</span>);</div><div class="line">    }</div><div class="line">    puts(<span class="stringliteral">&quot;helper: Done&quot;</span>);</div><div class="line"></div><div class="line">    <a class="code" href="prompt__session_8c.html#a9e1d5207a160988089525cf90866e499">stop_session</a>(&amp;mcd, <span class="stringliteral">&quot;helper&quot;</span>);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// The main() function deals with parsing arguments and defaults</span></div><div class="line"><span class="keywordtype">int</span> <a name="a17"></a><a class="code" href="prompt__session_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[])</div><div class="line">{</div><div class="line">    <span class="comment">// Some variables for holding command line options</span></div><div class="line">    <span class="keywordtype">char</span> <span class="keyword">const</span> *server = NULL;</div><div class="line"></div><div class="line">    <span class="comment">// Parse the command line</span></div><div class="line">    {</div><div class="line">        <span class="keywordtype">int</span> arg;</div><div class="line">        opterr = 0;</div><div class="line">        <span class="keywordflow">while</span> ((arg = getopt (argc, argv, <span class="stringliteral">&quot;c:hm:&quot;</span>)) != -1)</div><div class="line">        {</div><div class="line">            <span class="keywordflow">switch</span> (arg)</div><div class="line">            {</div><div class="line">            <span class="keywordflow">case</span> <span class="charliteral">&#39;m&#39;</span>:</div><div class="line">                server = optarg;</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">            <span class="keywordflow">case</span> <span class="charliteral">&#39;?&#39;</span>:</div><div class="line">            <span class="keywordflow">case</span> <span class="charliteral">&#39;h&#39;</span>:</div><div class="line">            <span class="keywordflow">default</span>:</div><div class="line">                puts(argv[0]);</div><div class="line">                puts(<span class="stringliteral">&quot;Usage:&quot;</span>);</div><div class="line">                puts(<span class="stringliteral">&quot;    -m &lt;Mir server socket&gt;&quot;</span>);</div><div class="line">                puts(<span class="stringliteral">&quot;    -h: this help text&quot;</span>);</div><div class="line">                <span class="keywordflow">return</span> -1;</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <a class="code" href="prompt__session_8c.html#a256fca07a603d0fa779f6e01be962923">helper</a>(server);</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --> </div><!-- contents -->
<hr>
<p align="center">Copyright &copy; 2012-2017
 Canonical Ltd. <br />
Generated on czw, 28 wrz 2017, 12:44:51 UTC
</p>
</body>
</html>
